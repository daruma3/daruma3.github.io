<!DOCTYPE html>
<html lamg="ja">

<head>
    <title>EDPC_J</title>
    <script async
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</head>

<body>
    <h1>EDPC J Sushi</h1>
    <h2>問題概要</h2>
    <h3><a href="https://atcoder.jp/contests/dp/tasks/dp_j">問題</a></h3>
    <p>全部でN枚の皿にそれぞれ，1,2,3カンいずれかの数だけすしが載っています．これらについて，<br>
        皿iをランダムに選ぶ．その皿に寿司が乗っていたなら一カン食べ，乗っていないなら何もしない．<br>全ての皿について選ぶ確率が
        等確率であるとき，すしを食べきる操作回数の期待値はいくらか．
    </p>


    <h2>方針</h2>
    <p>
        期待値DPですが分かりませんでした．<br>
        皿に乗っている寿司の数で分類します．1,2,3カン乗っている皿がいくつずつあるかの各場合について期待値をメモ化しておきます．
        ただし期待値の計算が非常に複雑です．とりあえず期待値を求める式を立て，それを整理することでループ用の式が得られるようです．
        詳しくは<a href="https://qiita.com/drken/items/03c7db44ccd27820ea0d">けんちょんさんの記事</a>まで．
    </p>


    <h2>コード</h2>
    <div style="overflow:scroll;padding:0;background-color:margin:0;background-color:#EEF;width:100%;"><code>
<ol style="list-style:decimal-leading-zero outside;in-left:0;padding-left:36px;margin:0;background-color:#EEF;white-space: nowrap;color:#000;">
<li style="background-color:#EEF;">#include &lt;bits/stdc++.h&gt;</li>
<li style="background-color:#EFF;">using namespace std;</li>
<li style="background-color:#EEF;">typedef long long ll;</li>
<li style="background-color:#EFF;">const ll INF = 1e18;</li>
<li style="background-color:#EEF;">const int INT_INF = 1e9;</li>
<li style="background-color:#EFF;">const ll MOD = 1e9 + 7;</li>
<li style="background-color:#EEF;">const int INT_MOD=1e9+7;</li>
<li style="background-color:#EFF;">#define rep(i, n) for(int i = 0; i &lt; n; i++)</li>
<li style="background-color:#EEF;">#define REP(i, n) for(int i = 0; i &lt;= n; i++)</li>
<li style="background-color:#EFF;">#define rrep(i,n) for(int i=n;i&gt;0;i--)</li>
<li style="background-color:#EEF;">#define RREP(i,n) for(int i=n;i&gt;=0;i--)</li>
<li style="background-color:#EFF;">typedef pair&lt;int, int&gt; Pi;</li>
<li style="background-color:#EEF;">typedef pair&lt;double, double&gt; P;</li>
<li style="background-color:#EFF;">int n;</li>
<li style="background-color:#EEF;"><font style="color:green;font-style:italic;">//sushiのある皿がそれぞれi,j,k枚だった時の期待値</font></li>
<li style="background-color:#EFF;">double sushi[310][310][310];</li>
<li style="background-color:#EEF;">double dp(int i,int j,int k){</li>
<li style="background-color:#EFF;">&nbsp;&nbsp;&nbsp;&nbsp;if(sushi[i][j][k]){</li>
<li style="background-color:#EEF;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style="color:green;font-style:italic;">//一回訪れているとき，もう期待値が変わることはない</font></li>
<li style="background-color:#EFF;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(sushi[i][j][k]&gt;=0) return sushi[i][j][k];</li>
<li style="background-color:#EEF;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style="color:green;font-style:italic;">//もうsushiが無い</font></li>
<li style="background-color:#EFF;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(i==0 and j==0 and k==0) return 0.0;</li>
<li style="background-color:#EEF;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;double res=0;</li>
<li style="background-color:#EFF;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(i&gt;0) res+=dp(i-1,j,k)*i;</li>
<li style="background-color:#EEF;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(j&gt;0) res+=dp(i+1,j-1,k)*j;</li>
<li style="background-color:#EFF;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(k&gt;0) res+=dp(i,j+1,k-1)*k;</li>
<li style="background-color:#EEF;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font style="color:green;font-style:italic;">//期待値の計算</font></li>
<li style="background-color:#EFF;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;res=(res+n)/(i+j+k);</li>
<li style="background-color:#EEF;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return sushi[i][j][k]=res;</li>
<li style="background-color:#EFF;">&nbsp;&nbsp;&nbsp;&nbsp;}</li>
<li style="background-color:#EEF;">}</li>
<li style="background-color:#EFF;">signed main(){</li>
<li style="background-color:#EEF;">&nbsp;&nbsp;&nbsp;&nbsp;cin&gt;&gt;n;</li>
<li style="background-color:#EFF;">&nbsp;&nbsp;&nbsp;&nbsp;int one=0,two=0,three=0;</li>
<li style="background-color:#EEF;">&nbsp;&nbsp;&nbsp;&nbsp;rep(i,n){</li>
<li style="background-color:#EFF;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int x;</li>
<li style="background-color:#EEF;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cin&gt;&gt;x;</li>
<li style="background-color:#EFF;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if(x==1) one++;</li>
<li style="background-color:#EEF;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else if(x==2) two++;</li>
<li style="background-color:#EFF;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else three++;</li>
<li style="background-color:#EEF;">&nbsp;&nbsp;&nbsp;&nbsp;}</li>
<li style="background-color:#EFF;">&nbsp;&nbsp;&nbsp;&nbsp;memset(sushi,-1,sizeof(sushi));</li>
<li style="background-color:#EEF;">&nbsp;&nbsp;&nbsp;&nbsp;printf(<font style="color:brown;">"%.16f\n"</font>,dp(one,two,three));</li>
<li style="background-color:#EFF;">&nbsp;&nbsp;&nbsp;&nbsp;return 0;</li>
<li style="background-color:#EEF;">}</li>
</ol></code></div>

</body>